<link rel="stylesheet" href="/css/home.css" />

<div id="home-container">

  <section id="friends-list">
    <% if(locals.user) {%> 
      <h4><i class="ri-contacts-fill"></i> &nbsp; Friends</h4>
      <% friendList.forEach((friends)=>{ %>
        <% if(friends.status == 'accepted') {%> 
          <% if(friends.from_user._id == locals.user.id) {%>
            <p class="list-users">
                <img src="<%= friends.to_user.avatar %> " alt="<%= friends.to_user.name %>">
                <a href="/users/profile/<%= friends.to_user._id %>"><%= friends.to_user.name %></a>
                <a href=""><i class="fa-brands fa-facebook-messenger"></i></a>
            </p>
          <% }else if(friends.to_user._id == locals.user.id) {%>
            <p class="list-users">
              <img src="<%= friends.from_user.avatar %> " alt="<%= friends.from_user.name %>">
              <a href="/users/profile/<%= friends.from_user._id %>"><%= friends.from_user.name %></a>   
          </p> 
          <% } %>
        <% } %> 
      <% }) %> 
    <% } %> 
  </section>

  <section id="feed-posts">
    <% if(locals.user) { %>
    <form action="/posts/create" id="new-post-form" method="POST">
      <textarea name="content" cols="30" rows="2" placeholder=" What's in your mind ...???" required
      ></textarea>
      <input type="submit" value="POST" />
    </form>
    <% } %>
    <div id="posts-list-container">
      <h3 class="posts-title"><strong>POSTS</strong>&nbsp;<i class="fa-solid fa-code"></i></h3>
      <p>
        <% for(post of posts){ %>
          <%- include('_post') -%>
        <% } %>
      </p>
    </div>
  </section>

  <section id="user-friends">
    <h4><i class="ri-team-line"></i>&nbsp;Users</h4>
    <% for(users of all_users){ %>
      <% if(locals.user) { %>
      <p class="list-users">
        <% if(locals.user.id != users.id){ %> 
          <img src="<%= users.avatar %> " alt="<%= users.name %>">
          <a href="/users/profile/<%= users.id %>"><%= users.name %></a>
          <button id="addFrndBtn">
            <a href="/friends/send-req/?uid=<%= users.id %>&luid=<%= locals.user.id %>"><i class="ri-user-add-fill"></i></a>
          </button>
        <% } %>   
      </p>
      <% }else{ %>
        <p class="list-users">
          <img src="<%= users.avatar %> " alt="<%= users.name %>">
          <a href="/users/profile/<%= users.id %>"><%= users.name %></a>
        </p>
      <% } %>
    <% } %>
  </section>

  <%- include('_chatbox') -%> 
</div>
<script src="https://kit.fontawesome.com/bf0cf320c3.js" crossorigin="anonymous"></script>
<script src="/js/home_posts.js"></script>
<script src="/js/home_post_comments.js"></script>
<script src="/js/toggle_like.js"></script>
<script>
    let toggleLikeButton = document.querySelectorAll(".toggle-like-button");
    toggleLikeButton.forEach(function(toggleElement){
      // console.log(toggleElement);
      let toggleLike = new ToggleLike(toggleElement);
    })
</script>
<script src="/js/frineds.js"></script>


